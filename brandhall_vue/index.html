<!doctype html>
<html lang="zh-cn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script type="text/javascript">window._ROOT_ = "../";</script>
    <script type="text/javascript" src="./common/config/config.js"></script>
    <script type="text/javascript" src="../LAM2/lamborghiniJS/base/System.js"></script>
    <script type="text/javascript">
        LAM.main=function (view, buildHtml) {
            // console.log(view);
            var System = this;
            var r = System.get('r');
            const ACCESS_TOKEN = localStorage.getItem('access_token');
            
            System.COOKIE_GUEST.find('auth_key', ACCESS_TOKEN,function (index, id) {
                var _this = this;
                if(-1 === index){
                    if(!(r === 'site/login' || r === 'site/reg'))
                        System.redirect(System.INDEX+"site/login");
                }else{
                    
                    System.listen(() => {
                        if(this.had_expired(index)){
                            this.remove(index);
                            System.redirect(System.INDEX+"site/login");
                        }
                    },1);

                    let data = this.get(index);
                    if(ACCESS_TOKEN === data.auth_key && (r === 'site/login' || r === 'site/reg')){
                        System.redirect(System.INDEX+System.routeRules.index);
                    }
                }
            });


            buildHtml = buildHtml
                            .replaceAll('../', '../../../')
                            .replaceAll('/brandhall_vue/index.html?r=site/index', '/brandhall_vue/build/site/index.html');

            var arr = r.split('/');                
            var filename = arr[1];
            
            // $.post(System.SERVER2,{
            //     'content': buildHtml,
            //     'path':"/www/brandhall_vue/build/" + arr[0],
            //     'filename':filename+'.html'
            // },function(data){


            // },'json');

            
            // $.post(System.SERVER+"/index/build",{
            //     'content': buildHtml,
            //     'ftp_server':"192.168.3.10:9527",
            //     'path':"/brandhall_vue/build/" + System.get('r'),
            //     'suffix':'.html'
            // },function(view){

            // },'json');


            return view;
        };
        LAM.bootstrap();
    </script>
</head>
</html>


